#!/usr/bin/env ruby
require 'gli'
require 'biotcm'

extend GLI::App

program_desc 'An app store for bioinformatics tools in Ruby'
version BioTCM::VERSION
subcommand_option_handling :normal

desc 'Create a new BioTCM app gem'
arg 'app_name'
command :init do |c|
  c.action do |_global_options, _options, args|
    app_name = args.shift
    exit_now!('app_name not given.') unless app_name
    app_name = 'biotcm-' + app_name.gsub(/^biotcm-/, '')
    system("bundle gem #{app_name}")
  end
end

desc 'Run an installed BioTCM app'
arg 'app_name'
command :run do |c|
  BioTCM::Apps.apps.each do |app, app_attr|
    c.desc app_attr['description']
    c.command app do |subc|
      require app_attr['gem-name'] if app_attr['gem-name']
      BioTCM::Apps.const_get(app_attr['class-name']).gli(subc)
    end
  end
end

desc 'Run BioTCM in console'
command :console do |c|
  c.action { BioTCM.console }
end

exit run(ARGV)
